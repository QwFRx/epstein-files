# Система автоматизации школьной столовой (Frontend + Backend)

Профессиональное приложение для управления школьным питанием, заказами и складским учётом. Проект состоит из двух частей:

* `backend/` — API на FastAPI (Python).
* `frontend/` — SPA на React + Vite.

---

## Содержание

* [Ключевые возможности](#ключевые-возможности)
* [Технологии](#технологии)
* [Структура проекта](#структура-проекта)
* [Требования](#требования)
* [Установка и запуск (Backend)](#установка-и-запуск-backend)
* [Установка и запуск (Frontend)](#установка-и-запуск-frontend)
* [Настройка адреса API для фронта](#настройка-адреса-api-для-фронта)
* [Сборка фронта для продакшена](#сборка-фронта-для-продакшена)
* [Тестовые учётные записи](#тестовые-учётные-записи)
* [Траблшутинг (частые проблемы)](#траблшутинг-частые-проблемы)
* [Контакты / Авторы](#контакты--авторы)
* [Лицензия](#лицензия)

---

## Ключевые возможности

* Авторизация через JWT + хеширование паролей (bcrypt).
* Ролевая модель: Student / Cook / Admin.
* Учёт ингредиентов на складе, списание при заказах.
* Проверка аллергенов по профилю ученика.
* Отчёты по выручке и остаткам.
* API с интерактивной документацией (Swagger).

---

## Технологии

**Backend**

* Python 3.12+
* FastAPI
* SQLAlchemy + SQLite
* Pydantic v2
* JOSE (JWT), Passlib (bcrypt)

**Frontend**

* React
* Vite
* JavaScript / JSX
* Простая fetch/axios-обёртка в `src/api.js`

---

## Структура проекта (пример)

```
epstein-files/
├── backend/
│   ├── routers/
│   ├── models.py
│   ├── schemas.py
│   ├── database.py
│   ├── main.py
│   ├── seed.py
│   ├── canteen.db
│   └── requirements.txt
└── frontend/
    ├── index.html
    ├── package.json
    ├── package-lock.json
    ├── vite.config.js
    └── src/
        ├── main.jsx
        ├── App.jsx
        ├── api.js
        └── components/
```

---

## Требования

* Node.js `18+` (рекомендуется 18 или 20).
* npm (доступен вместе с Node).
* Python `3.12+`.
* Git (если используете клонирование).

---

## Установка и запуск — Backend

1. **Клонировать репозиторий (если нужно):**

```bash
git clone https://github.com/<ваш-пользователь>/epstein-files.git
cd epstein-files
```

2. **Создать виртуальное окружение и активировать (рекомендуется):**

```bash
python -m venv .venv
# Linux / macOS
source .venv/bin/activate
# Windows (PowerShell)
.venv\Scripts\Activate.ps1
```

3. **Установить зависимости:**

```bash
pip install -r requirements.txt
```

4. **Заполнить базу тестовыми данными (seed):**

```bash
python -m backend.seed
```

> Если `seed.py` — модуль, убедитесь, что импортируется корректно (команда выше — запускает модуль как пакет). В противном случае можно запустить напрямую, например `python backend/seed.py`.

5. **Запустить сервер разработки:**

```bash
python -m uvicorn backend.main:app --reload
```

По умолчанию сервер будет доступен по: `http://127.0.0.1:8000`

6. **Swagger / OpenAPI:**
   Откройте в браузере `http://127.0.0.1:8000/docs` для интерактивной документации.

---

## Установка и запуск — Frontend (React + Vite)

1. Перейдите в папку фронтенда:

```bash
cd frontend
```

2. Установите зависимости:

```bash
# Если есть package-lock.json и хотите детерминированную установку:
npm ci

# Или, если предпочитаете:
npm install
```

3. (Опционально) проверьте/добавьте переменную окружения для адреса API (см. раздел ниже).

4. Запустите в режиме разработки:

```bash
npm run dev
```

5. Откройте приложение в браузере:

```
http://localhost:5173
```

(Порт по умолчанию — 5173; точный порт будет в консоли Vite.)

---

## Настройка адреса API для фронта

В проекте фронтенда обычно есть `src/api.js`, где определяется базовый URL API. Есть два распространённых подхода:

### 1) Переменная окружения Vite (рекомендовано)

Создайте файл `.env` в корне `frontend/` со строкой:

```
VITE_API_URL=http://127.0.0.1:8000
```

В коде используйте:

```js
const BASE = import.meta.env.VITE_API_URL || 'http://127.0.0.1:8000';
```

Важно: после изменения `.env` перезапустите `npm run dev`.

### 2) Хардкод в `src/api.js`

Откройте `src/api.js` и замените значение:

```js
export const API_BASE = 'http://127.0.0.1:8000';
```

Если ваш бэкенд запущен в другом месте (например, Docker-контейнер или удалённый сервер), поставьте соответствующий URL.

---

## Сборка фронта для продакшена

1. Сборка:

```bash
cd frontend
npm run build
```

2. Просмотр сборки (preview):

```bash
npm run preview
```

Если `preview` нет, можно использовать `serve`:

```bash
npm install -g serve
serve -s dist
```

---

## Тестовые учётные записи

(Прописаны в документации бэка/seed)

* **Студент:** `student` / `password123`
* **Админ:** `admin` / `password123`

---

## Частые проблемы и их решения

* **CORS ошибка в браузере**

  * Убедитесь, что в `backend/main.py` CORS разрешает origin `http://localhost:5173`. Для разработки можно временно разрешить все:

    ```py
    from fastapi.middleware.cors import CORSMiddleware
    app.add_middleware(
      CORSMiddleware,
      allow_origins=["http://localhost:5173"],
      allow_credentials=True,
      allow_methods=["*"],
      allow_headers=["*"],
    )
    ```

* **Фронт не видит API / 404 / 502**

  * Проверьте, что backend запущен (`uvicorn`) и доступен по адресу, который указан в фронте (`VITE_API_URL` / `src/api.js`).

* **`npm ci` падает**

  * Попробуйте удалить папки `node_modules` и файл `package-lock.json`, затем `npm install`.

* **Node версия не поддерживается**

  * Установите Node 18+ (nvm полезен для переключения версий).

* **Переменные окружения не применились**

  * Перезапустите процесс Vite (`ctrl+c` → `npm run dev`), Vite читает `.env` при старте.

* **База данных не создаётся / ошибки миграции**

  * Убедитесь, что `database.py` и `seed.py` корректно создают таблицы и что у процесса есть права на чтение/запись файла SQLite (`canteen.db`).

---

## Советы для разработки

* Проверяйте консоль браузера и терминал Vite при отладке фронта — там почти всегда подсказки.
* Для переключения окружений (dev/staging/prod) используйте `VITE_API_URL` с разными значениями.
* Для тестирования API удобно использовать Swagger (`/docs`) или Postman.

---

## Контакты / Авторы

* **Ярослав** — Frontend
* **Вовий** — Database Engineer
* **Иван** — Backend

---

## Лицензия

Код в репозитории — по умолчанию без явной лицензии. Рекомендуется добавить выбранную лицензию (например, MIT) в корень проекта (`LICENSE`) и в `README.md`, если хотите явно разрешить использование.

---

Если хочешь — я могу:

* Вставить этот раздел прямо в `frontend/README.md` (готов дать версию, специально отформатированную для `frontend`),
* Или подготовить `README.md`, который вставляется в корень репозитория.

Скажи, куда ты хочешь вставить — я быстро подогнаю формат (корень/фронтенд).
